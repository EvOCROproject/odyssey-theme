---
import Layout from '../layouts/Page.astro';
import { Container } from '@components/odyssey-theme';
import { publications as allPubs } from '../data/publications';

// ci sono pubblicazioni?
const hasPubs = allPubs.length > 0;

// raggruppa per anno (decrescente) solo se ci sono dati
const pubsByYear = hasPubs
  ? allPubs
      .slice()
      .sort((a, b) => b.year - a.year)
      .reduce((acc, p) => {
        (acc[p.year] ||= []).push(p);
        return acc;
      }, {} as Record<number, typeof allPubs>)
  : {};

const seo = {
  title: 'Publications | EvOCRO',
  description: 'Peer-reviewed articles, conference papers and preprints from the EvOCRO project.',
};
---

<Layout {seo}>
  <Container>
    <section class="pubs-header">
      <h1>Publications</h1>
      <p class="intro">
        Peer-reviewed articles, conference papers, book chapters and preprints related to the EvOCRO project.
      </p>
    </section>

    <section class="pubs-list">
      {!hasPubs && <p class="coming-soon">Coming soon.</p>}

      {hasPubs &&
        Object.keys(pubsByYear)
          .sort((a, b) => Number(b) - Number(a))
          .map((year) => (
            <div class="year-block">
              <h2 class="year">{year}</h2>
              <ol>
                {pubsByYear[Number(year)].map((p) => (
                  <li class="pub">
                    <div class="meta">
                      <span class="authors">{p.authors}</span>
                      <span class="title">
                        {p.url ? (
                          <a href={p.url} target="_blank" rel="noopener noreferrer">
                            {p.title}
                          </a>
                        ) : (
                          p.title
                        )}
                      </span>
                      {p.venue && <span class="venue">— {p.venue}</span>}
                      {p.note && <span class="note">({p.note})</span>}
                      {p.doi && (
                        <span class="doi">
                          •{' '}
                          <a
                            href={`https://doi.org/${p.doi}`}
                            target="_blank"
                            rel="noopener noreferrer"
                          >
                            doi:{p.doi}
                          </a>
                        </span>
                      )}
                    </div>
                  </li>
                ))}
              </ol>
            </div>
          ))}
    </section>
  </Container>
</Layout>

<style>
  .pubs-header { margin: calc(var(--section-margin)/2) auto 1rem; }
  .pubs-header h1 {
    margin: 0 0 .25rem 0;
    font-size: clamp(2rem, 3.5vw, 2.6rem);
    letter-spacing: -0.01em;
  }
  .pubs-header .intro {
    margin: 0 0 1.5rem 0;
    color: var(--th
