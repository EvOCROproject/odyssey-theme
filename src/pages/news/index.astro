---
import Layout from '../../layouts/Page.astro';

const items = (await Astro.glob('./posts/*.mdx'))
  .map((p) => {
    const fm = p.frontmatter ?? {};
    const date = fm.date ? new Date(fm.date) : null;
    return {
      url: p.url,                // pagina interna
      title: fm.title ?? 'Untitled',
      source: fm.source ?? '',   // testata / fonte
      extLink: fm.link ?? null,  // link esterno alla news originale
      image: fm.featuredImage ?? null,
      date,
      excerpt: fm.excerpt ?? '',
      tags: fm.tags ?? [],
    };
  })
  .sort((a, b) => (b.date?.getTime() ?? 0) - (a.date?.getTime() ?? 0));
---

<Layout title="News" description="Press coverage and external mentions">
  <section class="hero">
    <h1>News</h1>
    <p>Press coverage, external mentions, and announcements not part of the blog/vlog.</p>
  </section>

  <section class="grid-wrap">
    {items.length === 0 && <p>No news yet.</p>}
    <ul class="grid">
      {items.map((it) => (
        <li class="card">
          <a class="link" href={it.extLink ?? it.url} target={it.extLink ? "_blank" : undefined} rel={it.extLink ? "noopener" : undefined}>
            {it.image && (
              <div class="thumb">
                <img src={it.image} alt={it.title} loading="lazy" />
              </div>
            )}
            <div class="meta">
              {it.date && (
                <time datetime={it.date.toISOString()}>
                  {it.date.toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: '2-digit' })}
                </time>
              )}
              {it.source && <span class="source">Â· {it.source}</span>}
            </div>
            <h3 class="title">{it.title}</h3>
            {it.excerpt && <p class="desc">{it.excerpt}</p>}
          </a>
        </li>
      ))}
    </ul>
  </section>
</Layout>

<style>
  .hero { margin: var(--section-margin) auto; max-width: 56rem; }
  .grid-wrap { margin: var(--section-margin) auto; }
  .grid {
    list-style: none; margin: 0; padding: 0;
    display: grid; gap: var(--theme-grid-gap);
    grid-template-columns: repeat(3, minmax(0,1fr));
  }
  @media (max-width: 1024px) { .grid { grid-template-columns: repeat(2,1fr); } }
  @media (max-width: 640px)  { .grid { grid-template-columns: 1fr; } }
  .card { background: var(--theme-surface-1); border-radius: var(--theme-shape-radius); overflow: hidden; }
  .link { display: block; color: inherit; text-decoration: none; height: 100%; }
  .thumb { aspect-ratio: 16/9; overflow: hidden; }
  .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .meta { display: flex; align-items: center; gap: .5rem; padding: .75rem 1rem 0; color: var(--theme-on-surface-2); font-size: .9rem; }
  .title { padding: .25rem 1rem 0; margin: 0; }
  .desc { padding: .5rem 1rem 1rem; margin: 0; color: var(--theme-on-surface-2); }
</style>
